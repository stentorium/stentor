"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[13412],{19916:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>y});var r=t(63696);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),d=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=d(e.components);return r.createElement(i.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef(function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=d(t),g=a,y=u["".concat(i,".").concat(g)]||u[g]||c[g]||s;return t?r.createElement(y,l(l({ref:n},p),{},{components:t})):r.createElement(y,l({ref:n},p))});function y(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,l=new Array(s);l[0]=g;var o={};for(var i in n)hasOwnProperty.call(n,i)&&(o[i]=n[i]);o.originalType=e,o[u]="string"==typeof e?e:a,l[1]=o;for(var d=2;d<s;d++)l[d]=t[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},22005:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>c,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var r=t(68102),a=(t(63696),t(19916));const s={id:"handlers",title:"Handler System"},l="Handler System",o={unversionedId:"handlers",id:"handlers",title:"Handler System",description:"Handlers are the core building blocks for conversation logic in Stentor. Each handler is responsible for processing a specific intent and generating appropriate responses.",source:"@site/../docs/Handlers.md",sourceDirName:".",slug:"/handlers",permalink:"/stentor/docs/handlers",draft:!1,editUrl:"https://github.com/stentorium/stentor/tree/master/docs/../docs/Handlers.md",tags:[],version:"current",frontMatter:{id:"handlers",title:"Handler System"},sidebar:"tutorialSidebar",previous:{title:"Getting Started",permalink:"/stentor/docs/getting-started"},next:{title:"Creating Custom Channels",permalink:"/stentor/docs/custom-channels"}},i={},d=[{value:"Overview",id:"overview",level:2},{value:"Handler Types",id:"handler-types",level:2},{value:"ConversationHandler",id:"conversationhandler",level:3},{value:"Custom Handlers",id:"custom-handlers",level:3},{value:"Handler Structure",id:"handler-structure",level:2},{value:"Handler Content",id:"handler-content",level:3},{value:"Key Handler Methods",id:"key-handler-methods",level:2},{value:"handleRequest()",id:"handlerequest",level:3},{value:"canHandleRequest()",id:"canhandlerequest",level:3},{value:"forwardingPathForRequest()",id:"forwardingpathforrequest",level:3},{value:"redirectingPathForRequest()",id:"redirectingpathforrequest",level:3},{value:"Handler Registration",id:"handler-registration",level:2},{value:"Handler Lifecycle",id:"handler-lifecycle",level:2},{value:"Advanced Features",id:"advanced-features",level:2},{value:"Input Unknown Handling",id:"input-unknown-handling",level:3},{value:"Forwarding",id:"forwarding",level:3},{value:"Redirects",id:"redirects",level:3},{value:"Session Management",id:"session-management",level:3},{value:"Context Management",id:"context-management",level:3},{value:"Repeat Functionality",id:"repeat-functionality",level:3},{value:"Response Building",id:"response-building",level:2},{value:"Handler Data",id:"handler-data",level:2},{value:"Permissions",id:"permissions",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Example Handler",id:"example-handler",level:2},{value:"Reference Files",id:"reference-files",level:2},{value:"Next Steps",id:"next-steps",level:2}],p={toc:d},u="wrapper";function c({components:e,...n}){return(0,a.yg)(u,(0,r.A)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"handler-system"},"Handler System"),(0,a.yg)("p",null,"Handlers are the core building blocks for conversation logic in Stentor. Each handler is responsible for processing a specific intent and generating appropriate responses."),(0,a.yg)("h2",{id:"overview"},"Overview"),(0,a.yg)("p",null,"The handler system provides a flexible, modular approach to managing conversation flow. Handlers:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Process incoming user requests (intents)"),(0,a.yg)("li",{parentName:"ul"},"Generate appropriate responses"),(0,a.yg)("li",{parentName:"ul"},"Manage conversation state and context"),(0,a.yg)("li",{parentName:"ul"},"Control conversation flow through forwarding and redirects"),(0,a.yg)("li",{parentName:"ul"},"Handle edge cases like unknown input and repeats")),(0,a.yg)("h2",{id:"handler-types"},"Handler Types"),(0,a.yg)("h3",{id:"conversationhandler"},"ConversationHandler"),(0,a.yg)("p",null,"The most basic handler for simple request/response interactions:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'import { ConversationHandler } from "stentor-handler";\n\nclass MyHandler extends ConversationHandler {\n  // Most functionality is inherited from AbstractHandler\n  // Override methods as needed for custom behavior\n}\n')),(0,a.yg)("h3",{id:"custom-handlers"},"Custom Handlers"),(0,a.yg)("p",null,"For specialized logic, extend ",(0,a.yg)("inlineCode",{parentName:"p"},"AbstractHandler"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'import { AbstractHandler } from "stentor-handler";\n\nclass CustomHandler extends AbstractHandler {\n  async handleRequest(request: Request, context: Context): Promise<Response> {\n    // Custom request processing logic\n    const response = this.responseBuilder\n      .respond("Hello from custom handler!")\n      .build();\n    return response;\n  }\n\n  canHandleRequest(request: Request, context: Context): boolean {\n    // Custom logic to determine if this handler can process the request\n    return request.intentId === this.intentId;\n  }\n}\n')),(0,a.yg)("h2",{id:"handler-structure"},"Handler Structure"),(0,a.yg)("p",null,"A handler is defined by a configuration object with the following properties:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},"interface Handler {\n  intentId: string;           // Unique intent identifier\n  appId: string;              // Application ID\n  organizationId: string;     // Organization ID\n  name?: string;              // Human-readable name\n  type: string;               // Handler class type\n  content?: Content;          // Response content for different intents\n  data?: Data;                // Handler data/configuration\n  forward?: Forward;          // Forwarding rules\n  redirect?: Redirect;        // Redirect rules\n  permissions?: UserDataType[]; // Required user data permissions\n}\n")),(0,a.yg)("h3",{id:"handler-content"},"Handler Content"),(0,a.yg)("p",null,"Handlers define responses in a ",(0,a.yg)("inlineCode",{parentName:"p"},"content")," object keyed by intentId:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'{\n  content: {\n    ["LaunchRequest"]: [\n      {\n        outputSpeech: {\n          ssml: "<speak>Welcome to my app!</speak>",\n          displayText: "Welcome to my app!"\n        },\n        reprompt: {\n          ssml: "<speak>What would you like to do?</speak>",\n          displayText: "What would you like to do?"\n        }\n      }\n    ]\n  }\n}\n')),(0,a.yg)("h2",{id:"key-handler-methods"},"Key Handler Methods"),(0,a.yg)("h3",{id:"handlerequest"},"handleRequest()"),(0,a.yg)("p",null,"Main entry point for processing requests:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},"async handleRequest(request: Request, context: Context): Promise<Response> {\n  // 1. Check redirects/gates\n  const redirectPath = this.redirectingPathForRequest(request, context);\n  if (redirectPath) {\n    // Handle redirect\n  }\n\n  // 2. Check forwarding\n  const forwardPath = this.forwardingPathForRequest(request, context);\n  if (forwardPath) {\n    // Forward to another handler\n  }\n\n  // 3. Process request and build response\n  const response = this.responseBuilder\n    .respond(this.content[request.intentId])\n    .build();\n\n  return response;\n}\n")),(0,a.yg)("h3",{id:"canhandlerequest"},"canHandleRequest()"),(0,a.yg)("p",null,"Determines if the handler can process a request:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},"canHandleRequest(request: Request, context: Context): boolean {\n  // Check if this handler's intentId matches the request\n  return request.intentId === this.intentId ||\n         this.content.hasOwnProperty(request.intentId);\n}\n")),(0,a.yg)("h3",{id:"forwardingpathforrequest"},"forwardingPathForRequest()"),(0,a.yg)("p",null,"Finds forwarding path for a request:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},"forwardingPathForRequest(request: Request, context: Context): string | undefined {\n  // Check forward rules and return intentId to forward to\n  if (this.forward && this.forward.conditions) {\n    // Evaluate conditions\n    // Return target intentId if conditions met\n  }\n  return undefined;\n}\n")),(0,a.yg)("h3",{id:"redirectingpathforrequest"},"redirectingPathForRequest()"),(0,a.yg)("p",null,"Finds redirect path (gate conditions):"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},"redirectingPathForRequest(request: Request, context: Context): string | undefined {\n  // Check redirect gates\n  // Return intentId if gate condition fails\n  return undefined;\n}\n")),(0,a.yg)("h2",{id:"handler-registration"},"Handler Registration"),(0,a.yg)("p",null,"Handlers are registered with the Assistant using ",(0,a.yg)("inlineCode",{parentName:"p"},"withHandlers()"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'import { Assistant } from "stentor";\nimport { MyHandler } from "./MyHandler";\n\nconst assistant = new Assistant()\n  .withHandlers([\n    MyHandler  // Handler class\n  ]);\n\n// Or with key-value mapping (for obfuscated code)\nassistant.withHandlers({\n  "MyHandler": MyHandler\n});\n')),(0,a.yg)("h2",{id:"handler-lifecycle"},"Handler Lifecycle"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Request Received")," - Runtime receives request from platform"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Channel Translation")," - Channel translates to Stentor format"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Handler Selection")," - HandlerManager/Factory selects appropriate handler"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Request Processing")," - Handler's ",(0,a.yg)("inlineCode",{parentName:"li"},"handleRequest()")," processes the request"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Response Building")," - Response is constructed using response builder"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Channel Translation")," - Response translated back to platform format")),(0,a.yg)("h2",{id:"advanced-features"},"Advanced Features"),(0,a.yg)("h3",{id:"input-unknown-handling"},"Input Unknown Handling"),(0,a.yg)("p",null,"Handlers can define strategies for when user input can't be matched:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'{\n  content: {\n    ["InputUnknown"]: [\n      {\n        name: "InputUnknownGlobal",\n        outputSpeech: {\n          ssml: "<speak>I didn\'t understand that. Could you try again?</speak>"\n        }\n      }\n    ]\n  }\n}\n')),(0,a.yg)("p",null,"Configuration strategies:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"REPROMPT")," - Re-ask the previous question"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"GLOBAL")," - Use global input unknown response")),(0,a.yg)("h3",{id:"forwarding"},"Forwarding"),(0,a.yg)("p",null,"Route to different handlers based on conditions:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'{\n  forward: {\n    conditions: [\n      {\n        should: "gt",\n        value: 5,\n        path: "{{data.counter}}",\n        intentId: "ThresholdReachedIntent"\n      }\n    ]\n  }\n}\n')),(0,a.yg)("h3",{id:"redirects"},"Redirects"),(0,a.yg)("p",null,"Gate logic that must pass before handling:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'{\n  redirect: {\n    conditions: [\n      {\n        should: "eq",\n        value: undefined,\n        path: "{{context.user.email}}",\n        intentId: "RequestEmailIntent"\n      }\n    ]\n  }\n}\n')),(0,a.yg)("h3",{id:"session-management"},"Session Management"),(0,a.yg)("p",null,"Track state across turns:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'async handleRequest(request: Request, context: Context): Promise<Response> {\n  // Read from session\n  const counter = context.session.get("counter") || 0;\n\n  // Update session\n  context.session.set("counter", counter + 1);\n\n  // Session is automatically persisted between turns\n}\n')),(0,a.yg)("h3",{id:"context-management"},"Context Management"),(0,a.yg)("p",null,"Access user data and conversation context:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},"async handleRequest(request: Request, context: Context): Promise<Response> {\n  // Access user data\n  const userId = context.user.userId;\n  const email = context.user.email;\n\n  // Access device info\n  const canPlayAudio = context.device.canPlayAudio;\n\n  // Access storage\n  const userData = await context.storage.read(userId);\n}\n")),(0,a.yg)("h3",{id:"repeat-functionality"},"Repeat Functionality"),(0,a.yg)("p",null,"Re-play previous response on repeat intent:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'class MyHandler extends ConversationHandler {\n  async handleRequest(request: Request, context: Context): Promise<Response> {\n    if (request.intentId === "AMAZON.RepeatIntent") {\n      // Return previous response from history\n      return this.getRepeatResponse(context);\n    }\n\n    // Normal handling\n    return super.handleRequest(request, context);\n  }\n}\n')),(0,a.yg)("h2",{id:"response-building"},"Response Building"),(0,a.yg)("p",null,"Handlers use a response builder to construct responses:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'this.responseBuilder\n  .respond("Hello!")                    // Add speech output\n  .reprompt("What would you like?")     // Add reprompt\n  .withCard({                           // Add visual card\n    title: "Welcome",\n    content: "Welcome to my app"\n  })\n  .withSuggestions(["Option 1", "Option 2"])  // Add quick replies\n  .build();\n')),(0,a.yg)("h2",{id:"handler-data"},"Handler Data"),(0,a.yg)("p",null,"Store handler-specific configuration in the ",(0,a.yg)("inlineCode",{parentName:"p"},"data")," property:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'{\n  data: {\n    maxAttempts: 3,\n    defaultGreeting: "Hello!",\n    customSettings: {\n      feature: "enabled"\n    }\n  }\n}\n')),(0,a.yg)("p",null,"Access in handler code:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},"const maxAttempts = this.data?.maxAttempts || 3;\n")),(0,a.yg)("h2",{id:"permissions"},"Permissions"),(0,a.yg)("p",null,"Request user data permissions:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'{\n  permissions: ["USER_NAME", "EMAIL_ADDRESS"]\n}\n')),(0,a.yg)("p",null,"This triggers permission request flows on supported platforms."),(0,a.yg)("h2",{id:"best-practices"},"Best Practices"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Single Responsibility"),": Each handler should manage one logical intent"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Content Configuration"),": Use ",(0,a.yg)("inlineCode",{parentName:"li"},"content")," for responses rather than hardcoding"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Error Handling"),": Always handle error cases gracefully"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Context Awareness"),": Leverage context for personalization"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Testing"),": Write unit tests for your handlers"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Reusability"),": Extract common logic to utility functions"),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Type Safety"),": Use TypeScript interfaces from stentor-models")),(0,a.yg)("h2",{id:"example-handler"},"Example Handler"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'import { ConversationHandler } from "stentor-handler";\nimport { Request, Response, Context } from "stentor-models";\n\nexport class GreetingHandler extends ConversationHandler {\n  async handleRequest(request: Request, context: Context): Promise<Response> {\n    // Get user name from context\n    const userName = context.user?.name || "there";\n\n    // Build personalized response\n    const response = this.responseBuilder\n      .respond(`Hello ${userName}! Welcome back.`)\n      .reprompt("What can I help you with today?")\n      .withCard({\n        title: "Welcome",\n        content: `Hello ${userName}!`\n      })\n      .build();\n\n    // Track usage in session\n    context.session.set("lastGreeting", new Date().toISOString());\n\n    return response;\n  }\n}\n')),(0,a.yg)("h2",{id:"reference-files"},"Reference Files"),(0,a.yg)("p",null,"View the source code on GitHub:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"AbstractHandler: ",(0,a.yg)("inlineCode",{parentName:"li"},"packages/stentor-handler/src/AbstractHandler/Handler.ts")),(0,a.yg)("li",{parentName:"ul"},"ConversationHandler: ",(0,a.yg)("inlineCode",{parentName:"li"},"packages/stentor-handler/src/ConversationHandler.ts")),(0,a.yg)("li",{parentName:"ul"},"Handler Interface: ",(0,a.yg)("inlineCode",{parentName:"li"},"packages/stentor-models/src/Handler/Handler.ts")),(0,a.yg)("li",{parentName:"ul"},"Handler Tests: ",(0,a.yg)("inlineCode",{parentName:"li"},"packages/stentor-handler/src/__test__/ConversationHandler.test.ts"))),(0,a.yg)("h2",{id:"next-steps"},"Next Steps"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Learn about ",(0,a.yg)("a",{parentName:"li",href:"/stentor/docs/custom-channels"},"Custom Channels")),(0,a.yg)("li",{parentName:"ul"},"Explore the ",(0,a.yg)("a",{parentName:"li",href:"/stentor/docs/getting-started"},"Getting Started")," guide")))}c.isMDXComponent=!0}}]);